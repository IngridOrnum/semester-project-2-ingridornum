import{A as L}from"./constants-BDf8nfUD.js";import"./main-DhbMNFkw.js";import{r as u,f}from"./listings-DTA2TBrG.js";async function y(t,a=24,n=0){const l=new URLSearchParams({q:t,limit:a,offset:n}),e=await fetch(`${L}/search?${l.toString()}`);if(!e.ok)throw new Error(`Error fetching search data: ${e.status}`);const i=await e.json();return{listings:i.data||[],meta:i.meta||{}}}let g="",s=0,c=40,d=[],I=[],w=!1,E="latest";document.getElementById("select-sorting").addEventListener("change",async t=>{const a=t.target.value;s=1,d=[],await m(s,g,a)});document.querySelectorAll('input[name="filter-radio"]').forEach(t=>{t.addEventListener("change",async()=>{s=1,d=[],await m(s,g,E)})});document.getElementById("loadMore").addEventListener("click",async()=>{w||(s++,await m(s,g,E))});async function m(t=1,a="",n,l){try{let e;if(a.trim())e=await y(a,c,t);else switch(n){case"latest":e=await u(c,t,"created","desc");break;case"a-z":e=await u(c,t,"title","asc");break;case"end-soon":e=await u(c,t,"endsAt","asc");break;default:e=await u(c,t)}let i=e.listings||[];console.log("fetched listings",i),I=e.meta||[],w=i.length<c;const p=new Date;n==="popular"&&(i.sort((r,o)=>o.bids.length-r.bids.length),console.log("After Sorting:",i.map(r=>({id:r.id,title:r.title,bidsCount:r.bids.length})))),d=[...d,...i],await h(d)}catch(e){console.error("Error displaying listings:",e),await h([])}}async function h(t){const a=document.querySelector(".listings-container");if(a.innerHTML="",t.length===0){a.innerHTML="<p>No listings found.</p>";return}for(const n of t){const l=new Date,e=new Date(n.endsAt),i=l>e,p=await f(n.endsAt),r=await f(n.created),o=document.createElement("li");o.classList.add("li-single-listing"),o.setAttribute("data-id",n.id),o.innerHTML=`
            <div class="li-single-listing-content border border-slate-900 p-2.5 flex flex-col">
                <img src="${n.media?.[0]?.url||"https://t3.ftcdn.net/jpg/05/88/70/78/360_F_588707867_pjpsqF5zUNMV1I2g8a3tQAYqinAxFkQp.jpg"}" alt="${n.media?.[0]?.alt||"No image"}">
                <span>${n.title}</span>
                <span>Created: ${r}</span>
                ${i?`
            <span class="uppercase text-red-800">Ended</span>
            `:`
            <span>Ends at</span>
            <span>${p}</span>
            `}

            </div>
        `,a.appendChild(o),o.addEventListener("click",()=>{localStorage.setItem("listingId",n.id),window.location.href="../../../../single-listing/index.html"})}}document.getElementById("searchInput").addEventListener("input",async t=>{g=t.target.value.trim(),s=1,await m(s,g)});document.getElementById("loginBtn").addEventListener("click",()=>{window.location="auth/login/index.html"});document.getElementById("registerBnt").addEventListener("click",()=>{window.location="auth/register/index.html"});m(1);
