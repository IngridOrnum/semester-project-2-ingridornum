import{A as x}from"./constants-BDf8nfUD.js";import"./main-B4YcYq6j.js";import{r as y}from"./read-C4asiSSn.js";import{g as w,h as E,t as L}from"./listings-Ubj3QYyM.js";/* empty css              */async function I(e,n=40,o=1,t="latest",i="all"){const s=new URLSearchParams({q:e,limit:n,offset:(o-1)*n,_seller:!0});t==="latest"?(s.append("sort","created"),s.append("sortOrder","desc")):t==="a-z"&&(s.append("sort","title"),s.append("sortOrder","asc")),i==="active"&&s.append("_active","true");const c={method:"GET"},a=await fetch(`${x}/search?${s.toString()}`,c);if(console.log("search API",`${x}?${s.toString()}`),!a.ok)throw new Error(`Error fetching search data: ${a.status}`);const f=await a.json();return console.log("API response data in search:",f),{listings:f.data||[],meta:f.meta||{}}}let g="",r=0,b=40,l=[],u=[],v=!1,p="latest",d="all";document.getElementById("filter-btn").addEventListener("click",()=>{const e=document.getElementById("filter-dropdown"),n=document.getElementById("dropdown-line");e.style.display=e.style.display==="flex"?"none":"flex",n.style.backgroundColor=n.style.backgroundColor==="rgb(198, 202, 199)"?"transparent":"rgb(198, 202, 199)"});document.querySelectorAll('input[name="filter-radio"]').forEach(e=>{e.addEventListener("change",async n=>{d=n.target.value,r=1,console.log(`Filter Value in API Call: ${d}`),await m(r,g,p,d)})});document.getElementById("searchButton").addEventListener("click",async()=>{g=document.getElementById("searchInput").value.trim(),r=1,await m(r,g,p,d)});document.getElementById("select-sorting").addEventListener("change",async e=>{p=e.target.value,r=1,await m(r,g,p,d)});document.getElementById("loadMore").addEventListener("click",async()=>{v?console.log("No more listings to load"):(r++,await m(r,g,p,d))});async function m(e=1,n="",o="latest",t="all"){try{console.log("Current Sort Option:",o);let i;e===1&&(l=[]);const s=u.totalCount-l.length,c=s<b?s:b;n.trim()?i=await I(n,c,e,o,t):i=await y(c,e,o,n,t);const a=i.listings||[];u=i.meta||{totalCount:l.length+a.length},v=l.length+a.length>=u.totalCount,l=[...l,...a],console.log("All Listings After Load:",l),console.log("All Listings:",l),await h(l)}catch(i){console.error("Error displaying listings:",i),await h([])}}async function h(e){const n=document.querySelector(".listings-container"),o=document.querySelectorAll(".listings-count");if(n.innerHTML="",d==="active"&&(e=e.filter(t=>new Date(t.endsAt)>new Date)),e.length===0){console.log("Displaying listings:",e),n.innerHTML='<p class="text-ui-black font-subtitle text-4xl">No listings found.</p>',o.forEach(t=>{t.innerHTML="0 of 0 listings"});return}o.forEach(t=>{t.innerHTML=`
        <span class="text-ui-black font-text text-sm">${e.length} of ${u.totalCount}</span>
        `});for(const t of e){const i=await w(t.bids),s=E(t.endsAt),c=L(t.endsAt),a=document.createElement("li");a.classList.add("li-single-listing"),a.setAttribute("data-id",t.id),a.innerHTML=`
            <div class="li-single-listing-content flex flex-col relative rounded-xl">
                <div class="flex items-center gap-2 tablet:gap-4 p-2">
                    <img class="rounded-full h-7 w-7 tablet:h-10 tablet:w-10 object-cover" src="${t.seller?.avatar.url||"public/assets/images/missing-img.jpg"}" alt="Avatar User">
                    <span class="font-text text-ui-black text-sm">${t.seller?.name}</span>
                </div>
                <div>
                    ${s?'<div id="ended-notif" class="font-text text-xs text-notif-red absolute m-3 mt-[68px] top-0 right-0 px-2 py-1 border border-notif-red bg-notif-bg-red z-1 rounded-full tablet:text-base">ENDED</div>':'<div id="active-notif" class=" font-text text-xs text-notif-green absolute m-3 mt-[68px] top-0 right-0 px-2 py-1 border border-notif-green bg-notif-bg-green z-1 rounded-full tablet:text-base">ACTIVE</div>'}
                </div>
                        <img class="listing-img" src="${t.media?.[0]?.url||"public/assets/images/missing-img.jpg"}" alt="${t.media?.[0]?.alt||"No image"}">
                        <div class="flex flex-col gap-4 p-4 min-h-[112px]">
                        <span class="flex justify-center font-subtitle text-ui-black text-lg tablet:text-2xl overflow-hidden whitespace-nowrap max-w-full">${t.title}</span>
                        ${s?' <span class="uppercase border flex justify-center rounded-md border-notif-red p-3 text-notif-red font-text text-xs tablet:text-base">Ended</span>':`
                       <div class="flex gap-5 justify-center items-center">
                           <div class="flex flex-col w-[110px] tablet:w-[136px] tablet:p-[8px] items-center  py-3 border-2 border-transparent bg-primary-green text-ui-white rounded-md font-text text-xs gap-1 font-light tablet:text-base">
                                <span class="text[8px] tablet:text-sm uppercase">Highest bid</span>
                                <span class="text-[14px] tablet:text-lg">${i} credits</span>
                            </div>
                            <div class="flex flex-col w-[110px] tablet:w-[136px] tablet:p-[8px] items-center py-3 border-2 border-primary-green text-ui-black rounded-md font-text text-xs gap-1 font-light tablet:text-base">
                                <span class="text[8px] tablet:text-sm font-medium uppercase">Ends in</span>
                                <span class="text-[14px] tablet:text-lg"> ${c}</span>
                            </div>
                       </div>
                </div>
                `}
            </div>
        `,n.appendChild(a),a.addEventListener("click",()=>{localStorage.setItem("listingId",t.id),window.location.href="../../../../single-listing/"})}}document.getElementById("loginBtn").addEventListener("click",()=>{window.location="auth/login/index.html"});document.getElementById("registerBnt").addEventListener("click",()=>{window.location="auth/register/index.html"});m(1);
