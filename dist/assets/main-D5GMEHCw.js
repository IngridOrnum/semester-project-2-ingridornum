import{d as m,e as f,a as p}from"./constants-Bid5ThXw.js";async function h(t,n=12,e=1){const a=new URLSearchParams({q:t,limit:n,page:e}),o=await fetch(`${m}/search?${a.toString()}`);if(!o.ok)throw new Error(`Error fetching search data: ${o.status}`);const r=await o.json();return{listings:r.data||[],meta:r.meta||{}}}async function y(t=12,n=1){const e=new URLSearchParams({limit:t,page:n}),a=await fetch(`${m}?${e.toString()}`);if(!a.ok)throw new Error(`Error fetching data: ${a.status}`);const o=await a.json();return{listings:o.data||[],meta:o.meta||{}}}async function E(){const t=localStorage.getItem("accessToken");if(t)return t;throw new Error("AccessToken or username not found")}async function L(t){const n=await E(),e={headers:{"X-Noroff-API-Key":p,Authorization:`Bearer ${n}`,"Content-Type":"application/json"}},a=await fetch(`${f}/${t}`,e);if(!a.ok)throw console.error("Failed to fetch profile data:",a),new Error(`Error fetching profile data: ${a.status}`);return await a.json()}let s=1;const g=12;let d="",l=[],i={};async function c(t=1,n=""){try{let e;n.trim()?(e=await h(n,g,t),l=e.listings||[],i=e.meta||{}):(console.log("Fetching default paginated listings."),e=await y(g,t),l=e.listings||e.data||[],i=e.meta||{}),u(l),v(i),I(i)}catch(e){console.error("Error displaying listings:",e),u([])}}function u(t){const n=document.querySelector(".listings-container");if(n.innerHTML="",t.length===0){n.innerHTML="<p>No listings found.</p>";return}t.forEach(e=>{const a=document.createElement("li");a.classList.add("li-single-listing"),a.setAttribute("data-id",e.id),a.innerHTML=`
            <div class="li-single-listing-content">
                <img src="${e.media?.[0]?.url||""}" alt="${e.media?.[0]?.alt||"No image"}">
                <span>${e.title}</span>
            </div>
        `,n.appendChild(a)})}function v(t){const n=document.getElementById("prevPage"),e=document.getElementById("nextPage");n.disabled=!t.previousPage,e.disabled=!t.nextPage}function I(t){const n=document.getElementById("paginationCount"),e=Math.min(t.currentPage*g,t.totalCount);n.innerHTML=`
        <span>Showing ${e} of ${t.totalCount}</span>
    `}document.getElementById("prevPage").addEventListener("click",()=>{i.previousPage&&(s=i.previousPage,c(s,d))});document.getElementById("nextPage").addEventListener("click",()=>{i.nextPage&&(s=i.nextPage,c(s,d))});document.getElementById("searchInput").addEventListener("input",async t=>{d=t.target.value,s=1,await c(s,d)});document.getElementById("loginBtn").addEventListener("click",()=>{window.location="auth/login/index.html"});document.getElementById("registerBnt").addEventListener("click",()=>{window.location="auth/register/index.html"});c(s);async function w(){const t=localStorage.getItem("loggedInUsername"),n=document.getElementById("logoutBtn"),e=document.getElementById("loginBtn"),a=document.getElementById("registerBnt");if(t){e&&e.classList.add("hidden"),a&&a.classList.add("hidden"),n&&n.classList.remove("hidden");try{const o=await L(t),r=document.getElementById("user-display-nav");r&&(r.innerHTML=`
<span>Your credits: ${o.data.credits}</span>
<div id="my-profile" class="flex gap-2.5 items-center cursor-pointer">
<span>${o.data.name}</span>
<img src="${o.data.avatar.url||"/default-avatar.png"}" alt="User Avatar" style="width:40px; height:40px; border-radius:50%;">
</div> 
                `)}catch(o){console.error("Error displaying user profile:",o)}}else{e&&(e.classList.remove("hidden"),e.classList.add("block")),a&&(a.classList.remove("hidden"),a.classList.add("block")),n&&n.classList.add("hidden");const o=document.getElementById("user-display-nav");o&&(o.innerHTML="")}}async function B(){document.body.addEventListener("click",t=>{t.target.closest("#my-profile")&&(window.location.href="../../../../profile/index.html")})}function P(){localStorage.removeItem("accessToken"),localStorage.removeItem("loggedInUsername"),alert("You logged out!"),location.reload()}function $(){const t=document.getElementById("logoutBtn");if(!t){console.log("No logout button found");return}t.addEventListener("click",function(){P()})}async function k(){w(),c(),$(),B()}k();
